<?xml version="1.0" encoding="utf-8"?>
<openerp>
    <data>

        <record model="ir.actions.act_window" id="act_hr_timesheet_sheet_sheet_2_hr_attendance">
            <field name="context">{'search_default_sheet_id': [active_id]}</field>
            <field name="name">Attendances</field>
            <field name="res_model">hr.attendance</field>
            <field name="src_model">hr_timesheet_sheet.sheet</field>
        </record>

        <!-- hr_timesheet inheritancy -->
        <record model="ir.ui.view" id="hr_timesheet_form_inherit">
            <field name="name">view_hr_timesheet_sheet_inherit</field>
            <field name="model">hr_timesheet_sheet.sheet</field>
            <field name="inherit_id" ref="hr_timesheet.hr_timesheet_form" />
            <field name="arch" type="xml">
                <xpath expr="//header/button[@name='button_confirm']" position="after">
                    <button name="button_confirm" states="draft" string="Submit to Manager" type="object" class="oe_highlight"/>
                    <button name="done" states="confirm" string="Approve" type="workflow" groups="base.group_hr_user" class="oe_highlight"/>
                    <button name="action_set_to_draft" states="done" string="Set to Draft" type="object" />
                    <button name="cancel" states="confirm" string="Refuse" type="workflow" groups="base.group_hr_user" />
                </xpath>
                <xpath expr="//div[@class='oe_right oe_button_box']" position="inside">
                    <button type="action" groups="base.group_hr_attendance"
                        class="oe_stat_button" icon="fa-users"
                        name="%(act_hr_timesheet_sheet_sheet_2_hr_attendance)d">
                        <field name="attendance_count" widget="statinfo" string="Attendances"/>
                    </button>
                </xpath>
                <xpath expr="//sheet/group" position="inside">
                    <group groups="base.group_hr_attendance">
                        <field name="total_attendance" widget="float_time"/>
                        <field name="total_timesheet" widget="float_time"/>
                        <field name="total_difference" widget="float_time"/>
                    </group>
                </xpath>
                <xpath expr="//page[@string='Details']/field/tree/field[@name='unit_amount']" position="after">
                    <field name="to_invoice" widget="selection"/>
                </xpath>
                <xpath expr="//page[@string='Details']/field/form/field[@name='unit_amount']" position="after">
                    <field name="to_invoice"/>
                </xpath>
                <xpath expr="//page[@string='Details']" position="after">
                    <page string="Attendances" groups="base.group_hr_attendance">
                        <group>
                            <field context="{'employee_id': employee_id, 'user_id':user_id}" name="attendances_ids" nolabel="1">
                                <tree string="Attendances" editable="bottom">
                                    <field name="name"/>
                                    <field name="action"/>
                                    <field invisible="1" name="employee_id"/>
                                </tree>
                            </field>
                            <group>
                                <label for="state_attendance"/>
                                <div>
                                    <field name="state_attendance"/>
                                    <button name="attendance_action_change" attrs="{'invisible': [('state_attendance', '=', 'present')]}" type="object" string="Sign In" class="oe_link"/>
                                    <button name="attendance_action_change" attrs="{'invisible': ['|', ('state_attendance','=',False), ('state_attendance', '=', 'absent')]}" type="object" string="Sign Out" class="oe_link"/>
                                </div>
                            </group>
                        </group>
                        <field name="period_ids">
                            <tree colors="red:total_difference&lt;0.1;blue:total_difference&gt;=0.1" string="Period">
                                <field name="name"/>
                                <field name="total_attendance" widget="float_time" sum="Attendances"/>
                                <field name="total_timesheet" widget="float_time" sum="Timesheets"/>
                                <field name="total_difference" widget="float_time" sum="Differences"/>
                            </tree>
                        </field>
                    </page>
                </xpath>
            </field>
        </record>

        <record model="ir.ui.view" id="hr_timesheet_tree_simplified_inherit">
            <field name="name">hr.timesheet.sheet.tree.inherit</field>
            <field name="model">hr_timesheet_sheet.sheet</field>
            <field name="inherit_id" ref="hr_timesheet.hr_timesheet_tree_simplified" />
            <field name="arch" type="xml">
                <field name="department_id" position="after">
                    <field name="total_attendance" widget="float_time" groups="base.group_hr_attendance"/>
                    <field name="total_timesheet" widget="float_time"/>
                    <field name="total_difference" widget="float_time" groups="base.group_hr_attendance"/>
                </field>
            </field>
        </record>

        <!--
            Company inheritancy
        -->
        <record id="hr_timesheet_sheet_company" model="ir.ui.view">
            <field name="name">res.company.timesheet.sheet</field>
            <field name="model">res.company</field>
            <field name="inherit_id" ref="base.view_company_form"/>
            <field name="arch" type="xml">
                <xpath expr="//group[@name='timesheets_grp']" position="inside">
                    <field name="timesheet_max_difference"/>
                </xpath>
            </field>
        </record>

        <record id="hr_timesheet_account_form" model="ir.ui.view">
            <field name="name">hr.timesheet.account.form</field>
            <field name="model">hr_timesheet_sheet.sheet.account</field>
            <field name="arch" type="xml">
                <form string="Timesheet by Accounts" version="7.0">
                    <group col="4">
                        <field name="sheet_id"/>
                        <field name="name" groups="analytic.group_analytic_accounting"/>
                        <field name="total" sum="Total"/>
                        <field name="invoice_rate"/>
                    </group>
                </form>
            </field>
        </record>
        <record id="hr_timesheet_account_filter" model="ir.ui.view">
            <field name="name">hr.timesheet.account.filter</field>
            <field name="model">hr_timesheet_sheet.sheet.account</field>
            <field name="arch" type="xml">
                <search string="Search Account">
                    <field name="name" groups="analytic.group_analytic_accounting"/>
                    <field name="invoice_rate"/>
                    <field name="sheet_id" />
                </search>
            </field>
        </record>
        <record id="hr_timesheet_account_tree" model="ir.ui.view">
            <field name="name">hr.timesheet.account.tree</field>
            <field name="model">hr_timesheet_sheet.sheet.account</field>
            <field name="arch" type="xml">
                <tree string="Timesheet by Accounts">
                    <field name="sheet_id"/>
                    <field name="name" groups="analytic.group_analytic_accounting"/>
                    <field name="total" sum="Total"/>
                    <field name="invoice_rate"/>
                </tree>
            </field>
        </record>

        <!--
            hr.attendance inheritancy
        -->

        <record model="ir.ui.view" id="view_hr_attendance_filter">
            <field name="name">view_hr_attendance_filter</field>
            <field name="model">hr.attendance</field>
            <field name="inherit_id" ref="hr_attendance.view_hr_attendance_filter" />
            <field name="arch" type="xml">
                <field name="employee_id" position="after">
                    <field name="sheet_id"/>
                </field>
            </field>
        </record>

        <record id="view_attendance_form" model="ir.ui.view">
            <field name="name">hr.attendance.form</field>
            <field name="model">hr.attendance</field>
            <field name="inherit_id" ref="hr_attendance.view_attendance_form"/>
            <field name="arch" type="xml">
                <field name="action_desc" position="after">
                    <field name="sheet_id"/>
                </field>
            </field>
        </record>
        <record id="view_attendance_tree" model="ir.ui.view">
            <field name="name">hr.attendance.tree</field>
            <field name="model">hr.attendance</field>
            <field name="inherit_id" ref="hr_attendance.view_attendance_tree"/>
            <field name="arch" type="xml">
                <field name="action" position="after">
                    <field name="sheet_id"/>
                </field>
            </field>
        </record>
        <record id="view_attendance_tree_who" model="ir.ui.view">
            <field name="name">hr.attendance.tree</field>
            <field name="model">hr.attendance</field>
            <field name="inherit_id" ref="hr_attendance.view_attendance_who"/>
            <field name="arch" type="xml">
                <field name="action" position="after">
                    <field name="sheet_id"/>
                </field>
            </field>
        </record>

        <act_window
            context="{'search_default_sheet_id': [active_id]}"
            id="act_hr_timesheet_sheet_sheet_by_account"
            name="Timesheet by Account"
            groups="base.group_hr_attendance"
            res_model="hr_timesheet_sheet.sheet.account"
            src_model="hr_timesheet_sheet.sheet"/>

        <act_window
            context="{'search_default_sheet_id': [active_id]}"
            id="act_hr_timesheet_sheet_sheet_by_day"
            name="Timesheet by Day"
            groups="base.group_hr_attendance"
            res_model="hr_timesheet_sheet.sheet.day"
            src_model="hr_timesheet_sheet.sheet"/>

        <record id="hr_timesheet_day_tree" model="ir.ui.view">
            <field name="name">hr.timesheet.day.tree</field>
            <field name="model">hr_timesheet_sheet.sheet.day</field>
            <field name="arch" type="xml">
                <tree colors="blue:total_difference&lt;0.1;red:total_difference&gt;=0.1" string="Period">
                    <field name="name"/>
                    <field name="total_attendance" widget="float_time" sum="Total Attendances" groups="base.group_hr_attendance"/>
                    <field name="total_timesheet" widget="float_time" sum="Total Timesheet"/>
                    <field name="total_difference" widget="float_time" sum="Total Difference" groups="base.group_hr_attendance"/>
                </tree>
            </field>
        </record>

    </data>
</openerp>
